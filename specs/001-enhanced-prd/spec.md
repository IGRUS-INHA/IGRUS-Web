# Feature Specification: IGRUS 웹 시스템 PRD V2 보강

**Feature Branch**: `001-enhanced-prd`
**Created**: 2026-01-22
**Status**: Draft
**Input**: User description: "PRD V1을 보고 보강된 PRD V2를 작성"

## Clarifications

### Session 2026-01-22 (2차)
- Q: 데이터 모델 정규화? → A: User 테이블을 User(기본정보+역할), UserAuth(인증자격증명), UserSuspension(정지이력)으로 분리
- 분리 사유: 3NF 위반 해소 (status→suspendedUntil 이행 종속), 보안/책임 분리, 정지 이력 관리
- Q: role 위치? → A: User에 배치 (조직 내 위치를 나타내는 프로필 속성, 인가 개념이므로 인증 테이블에서 분리)

### Session 2026-01-22 (1차)
- Q: 회원가입 방식 변경? → A: 동아리 가입 = 웹 회원가입 동시 진행, MemberList 사전 검증 제거, 누구나 가입 신청 가능
- Q: 이메일 인증 필요 여부? → A: 불필요
- Q: 역할 체계 변경? → A: 비회원 → 준회원(가입신청, 미승인) → 정회원(승인됨) → 운영진 → 관리자 5단계
- Q: 준회원의 시스템 접근 권한? → A: 게시판별로 다른 읽기/쓰기 권한 적용
- Q: 준회원 게시판별 권한? → A: 공지사항(준회원 공개 설정된 글만 읽기) / 자유게시판(접근불가) / 정보공유(접근불가)
- Q: 준회원→정회원 승인 권한? → A: 관리자(ADMIN)만 승인 가능
- Q: 회원가입 필수 입력 정보? → A: 학번, 본명, 비밀번호, 이메일, 전화번호, 학과, 가입 동기
- Q: 준회원 행사 신청 권한? → A: 신청 불가, 정회원 승인 후에만 행사 신청 가능

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 신입 회원 가입 및 승인 흐름 (Priority: P1)

누구나 회원가입 신청을 할 수 있으며, 가입 즉시 준회원이 된다. 관리자(ADMIN)가 승인하면 정회원으로 전환되어 모든 기능을 이용할 수 있다.

**Why this priority**: 회원가입과 승인 흐름은 시스템 사용의 진입점으로, 모든 다른 기능의 전제조건이다.

**Independent Test**: 사용자가 회원가입 후 준회원으로 로그인하고, 관리자 승인 후 정회원 권한을 얻는지 검증

**Acceptance Scenarios**:

1. **Given** 비회원이, **When** 학번, 본명, 비밀번호, 이메일, 전화번호, 학과, 가입 동기를 입력하여 가입 신청하면, **Then** 준회원으로 등록되고 즉시 로그인이 가능하다
2. **Given** 이미 가입된 학번으로 재가입 시도할 때, **When** 가입 신청을 제출하면, **Then** "이미 가입된 계정입니다" 메시지가 표시된다
3. **Given** 준회원 상태에서, **When** 관리자(ADMIN)가 해당 회원을 승인하면, **Then** 정회원으로 전환되고 모든 게시판과 행사 신청 기능에 접근할 수 있다
4. **Given** 준회원 상태에서, **When** 자유게시판에 접근하면, **Then** "정회원 승인 후 이용 가능합니다" 메시지가 표시된다

---

### User Story 2 - 게시글 작성 및 상호작용 (Priority: P1)

정회원이 게시판에 글을 작성하고, 다른 정회원들이 댓글, 좋아요, 북마크로 상호작용할 수 있다. 준회원은 공지사항(준회원 공개 설정된 글만)만 읽을 수 있다.

**Why this priority**: 커뮤니티 활동의 핵심 기능으로, 동아리 웹사이트의 주요 가치를 제공한다.

**Independent Test**: 정회원의 게시글 작성, 댓글 달기, 좋아요/북마크 기능이 정상 동작하는지 검증

**Acceptance Scenarios**:

1. **Given** 로그인한 정회원이 자유게시판에서, **When** 제목과 내용을 입력하고 익명 옵션을 선택하여 글을 작성하면, **Then** 게시글이 등록되고 작성자는 "익명"으로 표시된다
2. **Given** 게시글 상세 화면에서, **When** 좋아요 버튼을 클릭하면, **Then** 좋아요 수가 1 증가하고 버튼 상태가 변경된다
3. **Given** 이미 좋아요한 게시글에서, **When** 좋아요 버튼을 다시 클릭하면, **Then** 좋아요가 취소되고 수가 1 감소한다
4. **Given** 게시글에 댓글이 있는 상태에서, **When** 게시글을 삭제하면, **Then** 게시글은 "삭제된 게시글입니다"로 표시되고 댓글은 유지된다

---

### User Story 3 - 행사 신청 및 관리 (Priority: P2)

정회원이 동아리 행사에 신청하고, 운영진/관리자가 행사를 생성/관리할 수 있다. 준회원은 행사 신청 불가.

**Why this priority**: 오프라인 활동 연계의 핵심이나, 게시판 기능보다는 사용 빈도가 낮다.

**Independent Test**: 행사 생성, 신청, 취소, 조기마감 기능 검증

**Acceptance Scenarios**:

1. **Given** 정원 50명인 행사에 35명이 신청한 상태에서, **When** 정회원이 신청하면, **Then** 신청이 완료되고 현재 신청자 수가 36명으로 업데이트된다
2. **Given** 정원이 가득 찬 행사에서, **When** 정회원이 신청하면, **Then** "정원이 마감되었습니다" 메시지가 표시되고 신청되지 않는다
3. **Given** 마감일이 지난 행사에서, **When** 정회원이 신청하면, **Then** "신청 기간이 종료되었습니다" 메시지가 표시된다
4. **Given** 관리자가 행사를 조기마감한 후, **When** 정회원이 신청하면, **Then** 신청이 불가하다
5. **Given** 준회원이 행사에 신청하려 할 때, **When** 신청 버튼을 클릭하면, **Then** "정회원 승인 후 신청 가능합니다" 메시지가 표시된다

---

### User Story 4 - 관리자 회원 관리 (Priority: P2)

ADMIN(관리자)이 준회원을 정회원으로 승인하고, 회원의 권한을 변경하며, 계정을 정지하거나 탈퇴시킬 수 있다. OPERATOR(운영진)는 콘텐츠/행사/문의 관리만 가능하다.

**Why this priority**: 운영에 필수적이나 일반 사용자 기능보다는 후순위이다.

**Independent Test**: 준회원 승인, 권한 변경, 계정 정지, 강제 탈퇴 기능 검증 (ADMIN 전용)

**Acceptance Scenarios**:

1. **Given** 준회원 계정에서, **When** ADMIN이 승인하면, **Then** 정회원으로 전환되고 모든 게시판/행사 기능에 접근 가능해진다
2. **Given** 정회원 계정에서, **When** ADMIN이 권한을 OPERATOR로 변경하면, **Then** 해당 회원이 운영진 기능(공지사항, 행사, 문의, 대시보드)에 접근할 수 있다
3. **Given** OPERATOR 계정에서, **When** ADMIN이 권한을 ADMIN으로 변경하면, **Then** 해당 회원이 모든 관리자 기능에 접근할 수 있다
4. **Given** 활성 회원이, **When** ADMIN에 의해 계정 정지되면, **Then** 모든 활성 토큰이 즉시 무효화되고 로그인이 불가해진다
5. **Given** 정지된 회원이 로그인 시도할 때, **When** 로그인 요청을 보내면, **Then** "계정이 정지되었습니다" 메시지가 표시된다
6. **Given** OPERATOR가 준회원 승인을 시도할 때, **When** 요청을 보내면, **Then** "관리자 권한이 필요합니다" 메시지가 표시된다

---

### User Story 5 - 문의하기 (Priority: P3)

비회원 또는 회원이 문의를 등록하고 관리자가 처리할 수 있다.

**Why this priority**: 보조 기능으로, 핵심 서비스 운영 후 구현해도 무방하다.

**Independent Test**: 문의 등록, 관리자 처리, 상태 변경 검증

**Acceptance Scenarios**:

1. **Given** 비로그인 사용자가, **When** 이메일을 포함하여 가입 문의를 등록하면, **Then** 문의 번호가 발급되고 접수 상태가 된다
2. **Given** 접수된 문의에서, **When** 관리자가 상태를 "처리중"으로 변경하면, **Then** 상태가 업데이트되고 내부 메모를 추가할 수 있다

---

### Edge Cases

- 비밀번호 재설정 링크가 30분 경과 후 클릭 시: "링크가 만료되었습니다" 메시지와 재요청 안내
- 동시에 여러 명이 마지막 정원 1자리에 신청 시: 선착순 처리, 실패한 사용자에게 정원 마감 메시지
- 관리자가 자기 자신을 정지/탈퇴 시도 시: 작업 거부 및 경고 메시지
- 게시글 이미지 5개 초과 업로드 시도 시: 최대 5개까지만 허용 메시지
- 댓글에 대댓글의 대댓글(2단계) 시도 시: 1단계까지만 허용 메시지
- 준회원이 정회원 전용 게시판/행사에 접근 시: "정회원 승인 후 이용 가능합니다" 메시지
- 준회원 승인 대기 목록이 비어있을 때 관리자가 승인 페이지 접근 시: 빈 목록 표시

## Requirements *(mandatory)*

### Functional Requirements

**인증 및 계정**
- **FR-001**: 시스템은 학번, 본명, 비밀번호, 이메일, 전화번호, 학과, 가입 동기를 입력받아 회원가입을 허용하고, 가입 즉시 준회원으로 등록해야 한다
- **FR-002**: 비밀번호는 영문+숫자+특수문자 조합 8자 이상이어야 한다
- **FR-003**: 준회원은 가입 즉시 로그인이 가능하며, 이메일 인증은 불필요하다
- **FR-004**: JWT 기반 인증으로 Access Token 1시간, Refresh Token 7일 유효기간을 적용해야 한다
- **FR-005**: 비밀번호 재설정 시 30분 유효한 인증 링크를 이메일로 발송해야 한다
- **FR-006**: 계정 정지/탈퇴 시 모든 활성 토큰을 즉시 무효화해야 한다

**역할 및 권한**
- **FR-007**: 역할은 준회원(ASSOCIATE) → 정회원(MEMBER) → 운영진(OPERATOR) → 관리자(ADMIN) 4단계로 구분해야 한다
- **FR-008**: ADMIN만 준회원을 정회원으로 승인할 수 있어야 한다
- **FR-009**: 준회원은 준회원 공개 설정된 공지사항만 읽을 수 있고, 자유게시판/정보공유 게시판에 접근할 수 없어야 한다
- **FR-010**: 준회원은 행사 신청이 불가해야 한다

**게시판**
- **FR-011**: 공지사항은 OPERATOR 이상이 작성 가능하고, 공지사항에는 준회원 공개 여부 설정 옵션을 제공해야 한다
- **FR-012**: 자유게시판과 정보공유는 정회원(MEMBER) 이상이 작성 가능해야 한다
- **FR-013**: 자유게시판에서만 익명 글 작성이 가능하며, 익명 설정은 수정 불가해야 한다
- **FR-014**: 게시글 제목은 100자, 이미지는 최대 5개(각 10MB) 제한을 적용해야 한다
- **FR-015**: 자유게시판 게시글에 "질문으로 등록" 옵션을 제공해야 한다
- **FR-016**: 게시글/댓글 삭제 시 Soft Delete(is_deleted=true)로 처리하고, UI에 "삭제됨" 표시해야 한다
- **FR-017**: 댓글은 최대 500자, 대댓글은 1단계까지만 허용해야 한다
- **FR-018**: 게시글당 좋아요와 북마크는 1인 1회로 제한하고, 취소 가능해야 한다

**행사**
- **FR-019**: OPERATOR 이상은 행사 등록/수정/삭제/조기마감/신청자 엑셀 다운로드가 가능해야 한다
- **FR-020**: 정회원(MEMBER) 이상은 마감일 전까지 행사 신청 및 취소가 가능해야 한다
- **FR-021**: 정원 초과, 마감일 경과, 수동 마감 시 신청을 거부해야 한다

**문의**
- **FR-022**: 문의 유형으로 가입문의, 행사문의, 신고, 계정문의, 기타를 제공해야 한다
- **FR-023**: 비로그인 사용자의 문의는 이메일 필수 입력이어야 한다
- **FR-024**: 문의 첨부파일은 최대 3개까지 허용해야 한다
- **FR-025**: OPERATOR 이상은 문의 상태를 접수→처리중→완료로 변경하고 내부 메모를 추가할 수 있어야 한다

**마이페이지**
- **FR-026**: 사용자는 학번, 본명, 이메일, 전화번호, 학과, 가입일, 칭호를 조회할 수 있어야 한다
- **FR-027**: 사용자는 이메일, 전화번호, 비밀번호를 수정할 수 있어야 한다
- **FR-028**: 내 게시글/댓글/좋아요/북마크/신청행사 목록을 조회할 수 있어야 한다
- **FR-029**: 탈퇴 시 비밀번호 확인을 거쳐 처리해야 한다

**관리 기능**
- **FR-030**: OPERATOR 이상은 대시보드에서 방문자, 게시글, 댓글, 가입자, 대기문의, 승인대기 준회원 수 통계를 조회할 수 있어야 한다
- **FR-031**: ADMIN만 준회원을 정회원으로 승인할 수 있어야 한다
- **FR-032**: ADMIN만 회원의 권한 변경(MEMBER↔OPERATOR↔ADMIN), 정지, 강제탈퇴, 칭호 설정이 가능해야 한다

### Key Entities

- **User (사용자 기본정보)**: 학번, 본명, 이메일, 전화번호, 학과, 가입동기, 역할(ASSOCIATE/MEMBER/OPERATOR/ADMIN), 칭호, 가입일
- **UserAuth (인증 자격증명)**: 사용자 ID, 비밀번호(해시), 상태(Active/Suspended/Withdrawn), 승인일, 승인자
- **UserSuspension (정지 이력)**: 사용자 ID, 정지사유, 정지시작일, 정지종료일, 정지처리자, 해제일, 해제처리자
- **Post (게시글)**: 게시판 종류, 제목, 내용, 작성자, 익명여부, 질문여부, 준회원공개여부(공지사항만), 이미지, 조회수, 삭제여부, 작성일
- **Comment (댓글)**: 게시글 ID, 부모댓글 ID, 내용, 작성자, 익명여부, 삭제여부, 작성일
- **Like (좋아요)**: 게시글 ID, 사용자 ID, 생성일
- **Bookmark (북마크)**: 게시글 ID, 사용자 ID, 생성일
- **Event (행사)**: 제목, 설명, 시작/종료 일시, 장소, 정원, 마감일, 상태
- **EventRegistration (행사 신청)**: 행사 ID, 사용자 ID, 신청일
- **Inquiry (문의)**: 유형, 제목, 내용, 이메일, 첨부파일, 상태, 내부메모, 작성일
- **RefreshToken**: 토큰값, 사용자 ID, 만료일

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 사용자가 회원가입을 시작부터 준회원 로그인까지 3분 이내에 완료할 수 있어야 한다
- **SC-002**: 게시글 작성에서 게시 완료까지 1분 이내에 가능해야 한다
- **SC-003**: 게시글 목록 페이지 로딩 후 사용자가 3초 이내에 게시글을 확인할 수 있어야 한다
- **SC-004**: 행사 신청 및 취소가 2번의 클릭 이내로 완료되어야 한다
- **SC-005**: 동시 사용자 100명이 접속해도 시스템이 정상 동작해야 한다
- **SC-006**: 관리자가 회원 상태 변경(승인, 정지 등) 후 즉시(5초 이내) 해당 회원의 권한이 반영되어야 한다
- **SC-007**: 모든 주요 기능(가입, 로그인, 게시글 작성, 행사 신청)의 성공률이 99% 이상이어야 한다
- **SC-008**: 준회원 승인 대기 목록이 관리자 대시보드에서 실시간으로 조회 가능해야 한다
