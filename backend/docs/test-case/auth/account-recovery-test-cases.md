# 탈퇴 계정 복구 테스트 케이스

**작성일**: 2026-01-23
**버전**: 1.0
**관련 스펙**: [auth-spec.md](../../../../docs/feature/auth/auth-spec.md)
**우선순위**: P3

---

## 1. 개요

탈퇴 계정 복구 기능에 대한 테스트 케이스입니다. 탈퇴한 사용자가 5일 이내에 계정을 복구할 수 있는 과정을 검증합니다. 개인정보보호법 파기 기한(5일)과 일치시켜 법적 정합성을 확보합니다.

---

## 2. 테스트 케이스

### 2.1 5일 이내 복구 가능

| ID | 테스트 케이스 | 사전 조건 | 테스트 단계 | 예상 결과 | 상태 |
|----|-------------|----------|-----------|----------|------|
| REC-001 | 탈퇴 직후 복구 시도 시 안내 메시지 | 탈퇴 직후 | 기존 학번과 비밀번호로 로그인 시도 | "탈퇴한 계정입니다. 복구하시겠습니까?" 메시지와 복구 가능 기한 표시 | ✅ |
| REC-002 | 5일 이내 복구 확인 화면 표시 | 탈퇴 후 3일 경과 | 기존 학번과 비밀번호로 로그인 시도 | 복구 확인 화면과 남은 복구 가능 기한 표시 | ✅ |
| REC-003 | 계정 복구 선택 시 상태 전환 | 복구 확인 화면 | "계정 복구" 선택 | 계정 상태 ACTIVE로 전환, 로그인 성공 | ✅ |
| REC-004 | 복구 후 정상적인 서비스 이용 | 계정 복구 완료 | 보호된 API 호출 | 정상 동작 | ✅ |
| REC-005 | 복구 시 기존 역할 유지 | MEMBER 역할로 탈퇴 후 복구 | 계정 복구 후 역할 확인 | MEMBER 역할 유지 | ✅ |

### 2.2 복구 거부

| ID | 테스트 케이스 | 사전 조건 | 테스트 단계 | 예상 결과 | 상태 |
|----|-------------|----------|-----------|----------|------|
| REC-010 | 복구 거부 시 로그인 불가 | 복구 확인 화면 | "복구 안함" 또는 취소 선택 | 로그인 실패, 메인 화면으로 이동 | ✅ |
| REC-011 | 복구 거부 후 재시도 가능 | 복구 거부 후 5일 이내 | 다시 로그인 시도 | 복구 확인 화면 다시 표시 | ✅ |

### 2.3 5일 경과 후 복구 불가

| ID | 테스트 케이스 | 사전 조건 | 테스트 단계 | 예상 결과 | 상태 |
|----|-------------|----------|-----------|----------|------|
| REC-020 | 5일 경과 후 로그인 시도 | 탈퇴 후 5일 초과 경과 | 기존 학번과 비밀번호로 로그인 시도 | "학번 또는 비밀번호가 일치하지 않습니다" 메시지 표시 | ✅ |
| REC-021 | 5일 경과 후 개인정보 파기 확인 | 탈퇴 후 5일 초과 경과 | 데이터베이스에서 사용자 정보 조회 | 개인정보 영구 삭제 (개인정보보호법 준수) | ✅ |
| REC-022 | 5일 경과 후 동일 학번 재가입 가능 | 탈퇴 후 5일 초과 경과 | 동일 학번으로 신규 가입 시도 | 정상적으로 회원가입 진행 가능 | ✅ |

### 2.4 5일 이내 재가입 제한

| ID | 테스트 케이스 | 사전 조건 | 테스트 단계 | 예상 결과 | 상태 |
|----|-------------|----------|-----------|----------|------|
| REC-030 | 5일 이내 동일 학번 재가입 시도 | 탈퇴 후 2일 경과 | 동일 학번으로 신규 가입 시도 | "탈퇴 후 5일이 지나야 재가입할 수 있습니다" 메시지와 재가입 가능일 표시 | ✅ |
| REC-031 | 재가입 가능일 정확히 표시 | 탈퇴 후 3일 경과 | 동일 학번으로 신규 가입 시도 | 정확한 재가입 가능 날짜/시간 표시 (2일 후) | ✅ |
| REC-032 | 탈퇴 후 4일 23시간 경과 시 재가입 제한 | 탈퇴 후 4일 23시간 경과 | 동일 학번으로 신규 가입 시도 | 재가입 불가, 남은 시간 표시 | ✅ |
| REC-033 | 정확히 5일 경과 후 재가입 가능 | 탈퇴 후 정확히 5일 경과 | 동일 학번으로 신규 가입 시도 | 정상적으로 회원가입 진행 가능 | ✅ |

### 2.5 Edge Cases

| ID | 테스트 케이스 | 사전 조건 | 테스트 단계 | 예상 결과 | 상태 |
|----|-------------|----------|-----------|----------|------|
| REC-040 | 탈퇴 전 활성화된 토큰으로 API 호출 | 탈퇴 처리 완료 | 탈퇴 전 발급받은 토큰으로 API 호출 | 401 Unauthorized (토큰 무효화됨) | ✅ |
| REC-041 | 복구 후 새 토큰 발급 | 계정 복구 완료 | 복구 시 토큰 상태 확인 | 새로운 Access/Refresh Token 발급 | ✅ |
| REC-042 | 잘못된 비밀번호로 복구 시도 | 탈퇴 후 5일 이내 | 올바른 학번 + 잘못된 비밀번호 입력 | "학번 또는 비밀번호가 일치하지 않습니다" 메시지 (복구 화면 미표시) | ✅ |

---

## 3. 관련 Functional Requirements

| ID | 요구사항 | 관련 테스트 케이스 |
|----|---------|------------------|
| FR-020 | 계정 상태 관리 | REC-003, REC-005 |
| FR-021 | 탈퇴 상태 사용자 로그인 차단 | REC-001, REC-002, REC-010 |
| FR-022 | 탈퇴 시 모든 토큰 무효화 | REC-040 |
| FR-023 | 탈퇴 후 5일 이내 복구 기능 | REC-001 ~ REC-011 |
| FR-024 | 탈퇴한 학번 5일 이내 재가입 차단 | REC-030 ~ REC-033 |
| FR-025 | 탈퇴 후 5일 경과 시 개인정보 영구 삭제 | REC-020, REC-021, REC-022 |

---

## 4. 테스트 클래스 구조

### 4.1 서비스 통합 테스트

**파일**: `src/test/java/igrus/web/security/auth/common/service/AccountRecoveryServiceTest.java`

AccountRecoveryService의 단위 테스트로, 복구 가능 여부 확인, 계정 복구, 재가입 가능 여부 등을 테스트합니다.

### 4.2 계정 복구 통합 테스트

**파일**: `src/test/java/igrus/web/security/auth/common/integration/AccountRecoveryIntegrationTest.java`

PasswordAuthService와 AccountRecoveryService를 함께 테스트하여 로그인 시 복구 프롬프트 로직을 검증합니다.

```java
@Nested
@DisplayName("탈퇴 계정 복구 테스트")
class AccountRecoveryTest {

    @Nested
    @DisplayName("5일 이내 복구 가능")
    class RecoveryWithinFiveDaysTest {
        // REC-001 ~ REC-005
    }

    @Nested
    @DisplayName("복구 거부")
    class RecoveryDeclineTest {
        // REC-010 ~ REC-011
    }

    @Nested
    @DisplayName("5일 경과 후 복구 불가")
    class RecoveryAfterFiveDaysTest {
        // REC-020 ~ REC-022
    }

    @Nested
    @DisplayName("5일 이내 재가입 제한")
    class ReRegistrationRestrictionTest {
        // REC-030 ~ REC-033
    }

    @Nested
    @DisplayName("Edge Cases")
    class EdgeCasesTest {
        // REC-040 ~ REC-042
    }
}
```

### 4.3 컨트롤러 엔드포인트

**컨트롤러**: `PasswordAuthController`

| HTTP Method | 경로 | 설명 |
|-------------|------|------|
| GET | `/api/v1/auth/password/account/recovery-check?studentId={studentId}` | 복구 가능 여부 확인 |
| POST | `/api/v1/auth/password/account/recover` | 계정 복구 |

### 4.4 예외 처리

- `AccountRecoverableException`: 복구 가능한 탈퇴 계정 로그인 시 발생
- `AccountWithdrawnException`: 복구 불가능한 탈퇴 계정 로그인 시 발생
- `AccountNotRecoverableException`: 복구 기간 만료 후 복구 시도 시 발생

---

## 5. 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2026-01-23 | - | 최초 작성 |
| 1.1 | 2026-01-25 | - | 컨트롤러 테스트 정보, 예외 처리 정보 추가 |
