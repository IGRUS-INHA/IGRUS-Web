# Feature Specification: 로그인/회원가입

**Created**: 2026-01-23
**Status**: Draft
**Input**: PRD V2 기반 로그인/회원가입 기능 명세

---

## User Scenarios & Testing

### User Story 1 - 회원가입 (Priority: P1)

비회원이 IGRUS 동아리 웹사이트에 가입하여 준회원이 되는 과정이다. 개인정보 수집 동의 후 필수 정보를 입력하고, 이메일 인증을 완료하면 준회원으로 등록된다.

**Why this priority**: 회원가입은 서비스 이용의 시작점으로, 이 기능 없이는 다른 모든 기능을 사용할 수 없다. 가장 기본적이고 필수적인 기능이다.

**Independent Test**: 회원가입 폼을 작성하고 이메일 인증을 완료하여 준회원으로 로그인할 수 있는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 비회원이 회원가입 페이지에 접속한 상태에서, **When** 개인정보 수집·이용 동의를 체크하지 않고 가입을 시도하면, **Then** 가입 버튼이 비활성화되어 있다
2. **Given** 비회원이 개인정보 동의를 완료한 상태에서, **When** 학번(8자리), 본명, 비밀번호(영문 대/소문자+숫자+특수문자, 8자 이상), 이메일, 전화번호, 학과, 가입 동기를 입력하고 제출하면, **Then** 입력한 이메일로 6자리 인증 코드가 발송된다
3. **Given** 인증 코드를 받은 사용자가, **When** 10분 이내에 올바른 인증 코드를 입력하면, **Then** 준회원(ASSOCIATE)으로 등록되고 로그인이 가능해진다
4. **Given** 인증 코드를 받은 사용자가, **When** 10분이 경과한 후 인증 코드를 입력하면, **Then** "인증 코드가 만료되었습니다. 재발송해주세요" 메시지가 표시된다
5. **Given** 인증 코드를 5회 이상 틀리게 입력한 사용자가, **When** 다시 인증을 시도하면, **Then** "인증 시도 횟수를 초과했습니다. 새 코드를 발급받아주세요" 메시지가 표시된다
6. **Given** 이미 가입된 학번으로, **When** 회원가입을 시도하면, **Then** "이미 가입된 계정입니다" 메시지가 표시된다

---

### User Story 2 - 로그인 (Priority: P1)

등록된 사용자가 학번과 비밀번호로 시스템에 로그인하여 서비스를 이용한다.

**Why this priority**: 로그인은 인증된 사용자만 접근할 수 있는 모든 기능의 진입점이다. 회원가입과 함께 가장 기본적인 기능이다.

**Independent Test**: 등록된 학번과 비밀번호로 로그인하여 사용자 정보와 역할이 올바르게 반환되는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 이메일 인증이 완료된 준회원이, **When** 올바른 학번과 비밀번호를 입력하면, **Then** 로그인에 성공하고 Access Token과 Refresh Token이 발급된다
2. **Given** 이메일 인증이 완료되지 않은 사용자가, **When** 로그인을 시도하면, **Then** "이메일 인증이 완료되지 않았습니다" 메시지가 표시된다
3. **Given** 사용자가, **When** 잘못된 학번 또는 비밀번호를 입력하면, **Then** "학번 또는 비밀번호가 일치하지 않습니다" 메시지가 표시된다
4. **Given** 계정이 정지(SUSPENDED)된 사용자가, **When** 로그인을 시도하면, **Then** "계정이 정지되었습니다"와 정지 해제 일시가 표시된다
5. **Given** 로그인한 사용자가, **When** 로그아웃을 요청하면, **Then** 현재 세션의 토큰이 무효화된다

---

### User Story 3 - 토큰 갱신 (Priority: P2)

로그인한 사용자가 Access Token 만료 시 Refresh Token을 사용하여 새로운 Access Token을 발급받는다.

**Why this priority**: 사용자 경험을 위해 세션이 자동으로 유지되어야 하며, 매번 재로그인하는 불편함을 방지한다.

**Independent Test**: 만료된 Access Token 상태에서 유효한 Refresh Token으로 새 Access Token을 발급받을 수 있는지 확인한다.

**Acceptance Scenarios**:

1. **Given** Access Token이 만료된 상태에서, **When** 유효한 Refresh Token으로 갱신을 요청하면, **Then** 새로운 Access Token이 발급된다
2. **Given** Refresh Token이 만료된 상태에서, **When** 토큰 갱신을 요청하면, **Then** "토큰이 만료되었습니다" 메시지와 함께 재로그인이 필요하다
3. **Given** 유효하지 않은 Refresh Token으로, **When** 갱신을 요청하면, **Then** "유효하지 않은 토큰입니다" 메시지가 표시된다

---

### User Story 4 - 비밀번호 재설정 (Priority: P2)

비밀번호를 잊은 사용자가 이메일을 통해 비밀번호를 재설정한다.

**Why this priority**: 비밀번호 분실은 흔히 발생하는 상황으로, 사용자가 계정에 다시 접근할 수 있는 방법을 제공해야 한다.

**Independent Test**: 비밀번호 재설정 링크를 통해 새 비밀번호를 설정하고 로그인할 수 있는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 비밀번호를 잊은 사용자가, **When** 학번을 입력하여 비밀번호 재설정을 요청하면, **Then** 등록된 이메일로 재설정 링크가 발송된다
2. **Given** 재설정 링크를 받은 사용자가, **When** 30분 이내에 링크를 클릭하고 새 비밀번호를 설정하면, **Then** 비밀번호가 변경되고 모든 기존 토큰이 무효화된다
3. **Given** 재설정 링크를 받은 사용자가, **When** 30분이 경과한 후 링크를 클릭하면, **Then** "링크가 만료되었습니다" 메시지가 표시된다

---

### User Story 5 - 탈퇴 계정 복구 (Priority: P3)

탈퇴한 사용자가 5일 이내에 계정을 복구할 수 있다.

**Why this priority**: 실수로 탈퇴한 사용자나 마음이 바뀐 사용자에게 계정을 복구할 기회를 제공한다. 개인정보보호법 파기 기한(5일)과 일치시켜 법적 정합성을 확보한다.

**Independent Test**: 탈퇴 후 5일 이내에 기존 학번과 비밀번호로 로그인하여 계정을 복구할 수 있는지 확인한다.

**Acceptance Scenarios**:

1. **Given** 5일 이내에 탈퇴한 사용자가, **When** 기존 학번과 비밀번호로 로그인을 시도하면, **Then** "탈퇴한 계정입니다. 복구하시겠습니까?" 메시지와 복구 가능 기한이 표시된다
2. **Given** 복구 확인 화면에서, **When** "계정 복구"를 선택하면, **Then** 계정 상태가 ACTIVE로 전환되고 로그인된다
3. **Given** 5일이 경과한 탈퇴 계정으로, **When** 로그인을 시도하면, **Then** "학번 또는 비밀번호가 일치하지 않습니다" 메시지가 표시된다 (개인정보 파기 완료)
4. **Given** 5일 이내에 탈퇴한 학번으로, **When** 신규 가입을 시도하면, **Then** "탈퇴 후 5일이 지나야 재가입할 수 있습니다" 메시지와 재가입 가능일이 표시된다

---

### User Story 6 - 준회원 승인 (Priority: P2)

관리자(ADMIN)가 준회원을 정회원으로 승인하여 전체 기능 접근 권한을 부여한다.

**Why this priority**: 동아리 회원 관리의 핵심 기능으로, 준회원이 정회원이 되어야 게시판, 행사 등 주요 기능을 이용할 수 있다.

**Independent Test**: 관리자가 준회원을 승인하면 해당 사용자의 역할이 MEMBER로 변경되고 전체 기능에 접근 가능한지 확인한다.

**Acceptance Scenarios**:

1. **Given** 관리자(ADMIN)가 승인 대기 준회원 목록을 조회할 때, **When** 목록을 요청하면, **Then** 학번, 본명, 학과, 가입 동기 등 상세 정보가 표시된다
2. **Given** 관리자가 특정 준회원을 선택하고, **When** 승인 버튼을 클릭하면, **Then** 해당 사용자의 역할이 MEMBER로 변경되고 승인일이 기록된다
3. **Given** 관리자가 여러 준회원을 선택하고, **When** 일괄 승인을 실행하면, **Then** 선택된 모든 사용자가 MEMBER로 승인된다
4. **Given** 운영진(OPERATOR)이, **When** 준회원 승인을 시도하면, **Then** "관리자 권한이 필요합니다" 메시지가 표시된다

---

### Edge Cases

- 회원가입 중 이메일 발송 실패 시 최대 3회 자동 재시도 (1분, 5분, 15분 간격)
- 인증 코드 재발송 요청 시 1분 대기 필요
- 인증 미완료 상태로 24시간 경과 시 임시 데이터 자동 삭제
- 동시에 여러 기기에서 로그인 시 각각 독립된 토큰 발급
- 계정 정지/탈퇴 시 모든 활성 토큰 즉시 무효화
- 마지막 ADMIN은 권한 변경 불가

---

## Requirements

### Functional Requirements

**회원가입**
- **FR-001**: 시스템은 회원가입 전 개인정보 수집·이용 동의를 필수로 받아야 한다
- **FR-002**: 시스템은 학번(8자리), 본명, 비밀번호, 이메일, 전화번호, 학과, 가입 동기를 필수 입력으로 받아야 한다
- **FR-003**: 시스템은 비밀번호를 영문 대/소문자 + 숫자 + 특수문자 조합, 최소 8자 이상으로 검증해야 한다
- **FR-004**: 시스템은 동일 학번, 이메일, 전화번호의 중복 가입을 방지해야 한다
- **FR-005**: 시스템은 가입 시 6자리 숫자 인증 코드를 이메일로 발송해야 한다
- **FR-006**: 시스템은 인증 코드를 10분 동안 유효하게 유지해야 한다
- **FR-007**: 시스템은 인증 코드 재발송 시 1분 대기를 적용해야 한다
- **FR-008**: 시스템은 인증 시도 횟수를 5회로 제한해야 한다
- **FR-009**: 시스템은 이메일 인증 완료 시 사용자를 준회원(ASSOCIATE)으로 등록해야 한다
- **FR-010**: 시스템은 인증 미완료 상태의 임시 데이터를 24시간 후 삭제해야 한다

**로그인/인증**
- **FR-011**: 시스템은 학번과 비밀번호로 사용자를 인증해야 한다
- **FR-012**: 시스템은 이메일 인증이 완료된 사용자만 로그인을 허용해야 한다
- **FR-013**: 시스템은 로그인 성공 시 Access Token(1시간 유효)과 Refresh Token(7일 유효)을 발급해야 한다
- **FR-014**: 시스템은 로그인 시 사용자의 역할(ASSOCIATE/MEMBER/OPERATOR/ADMIN) 정보를 반환해야 한다
- **FR-015**: 시스템은 Refresh Token으로 Access Token 재발급을 지원해야 한다
- **FR-016**: 시스템은 로그아웃 시 현재 세션의 토큰을 무효화해야 한다

**비밀번호 재설정**
- **FR-017**: 시스템은 학번 입력 시 등록된 이메일로 비밀번호 재설정 링크를 발송해야 한다
- **FR-018**: 시스템은 비밀번호 재설정 링크를 30분 동안 유효하게 유지해야 한다
- **FR-019**: 시스템은 비밀번호 재설정 완료 시 모든 기존 토큰을 무효화해야 한다

**계정 상태 관리**
- **FR-020**: 시스템은 계정 상태(ACTIVE, SUSPENDED, WITHDRAWN)를 관리해야 한다
- **FR-021**: 시스템은 정지(SUSPENDED) 또는 탈퇴(WITHDRAWN) 상태의 사용자 로그인을 차단해야 한다
- **FR-022**: 시스템은 계정 정지/탈퇴 시 모든 활성 토큰을 즉시 무효화해야 한다

**탈퇴 및 복구**
- **FR-023**: 시스템은 탈퇴 후 5일 이내 계정 복구 기능을 제공해야 한다
- **FR-024**: 시스템은 탈퇴한 학번으로 5일 이내 재가입을 차단해야 한다
- **FR-025**: 시스템은 탈퇴 후 5일 경과 시 개인정보를 영구 삭제해야 한다

**준회원 승인**
- **FR-026**: 시스템은 관리자(ADMIN)에게 준회원 목록 조회 기능을 제공해야 한다
- **FR-027**: 시스템은 관리자(ADMIN)만 준회원을 정회원으로 승인할 수 있어야 한다
- **FR-028**: 시스템은 개별 승인 및 일괄 승인 기능을 제공해야 한다

**개인정보 보호**
- **FR-029**: 시스템은 회원가입 시 개인정보 처리방침 전문 링크를 제공해야 한다
- **FR-030**: 시스템은 동의한 개인정보 처리방침 버전을 기록해야 한다
- **FR-031**: 시스템은 비밀번호를 단방향 해시(BCrypt)로 저장해야 한다

---

### Key Entities

- **User**: 사용자 기본정보 (학번, 본명, 이메일, 전화번호, 학과, 가입 동기, 역할)
- **PasswordCredential**: 비밀번호 인증 자격증명 (비밀번호 해시, 계정 상태, 승인 정보)
- **UserSuspension**: 계정 정지 이력 (정지 사유, 시작일, 종료일, 해제일)
- **UserRoleHistory**: 역할 변경 감사 이력
- **RefreshToken**: 리프레시 토큰 관리
- **EmailVerification**: 이메일 인증 코드 관리 (인증 코드, 만료 시간, 시도 횟수)
- **PrivacyConsent**: 개인정보 동의 이력

---

## Success Criteria

### Measurable Outcomes

- **SC-001**: 사용자는 회원가입 전체 과정(정보 입력 ~ 이메일 인증)을 5분 이내에 완료할 수 있다
- **SC-002**: 사용자는 로그인을 3초 이내에 완료할 수 있다
- **SC-003**: 인증 코드 이메일은 발송 요청 후 30초 이내에 수신된다
- **SC-004**: 비밀번호 재설정 이메일은 발송 요청 후 30초 이내에 수신된다
- **SC-005**: 90% 이상의 사용자가 첫 시도에 회원가입을 성공적으로 완료한다
- **SC-006**: 토큰 갱신 실패로 인한 강제 로그아웃 발생률이 1% 미만이다
- **SC-007**: 이메일 발송 성공률이 99% 이상이다 (재시도 포함)
- **SC-008**: 탈퇴 후 5일 이내 복구 요청의 100%가 정상적으로 처리된다

---

## Assumptions

- 인하대학교 재학생을 대상으로 하므로 14세 미만 사용자는 없다
- 이메일 발송을 위한 자체 SMTP 서버가 구축되어 있다
- HTTPS 전용 통신 환경이 구성되어 있다
- 한국 개인정보보호법을 준수한다

---

## Out of Scope

- 소셜 로그인 (OAuth2 등 외부 인증 연동)
- 2단계 인증 (2FA)
- 생체 인증
- 세션 동시 접속 제한
- 로그인 시도 횟수 제한 (Brute Force 방지) - 추후 보안 강화 시 검토
