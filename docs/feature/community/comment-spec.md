# Feature Specification: 댓글 (Comment)

**Feature Branch**: `001-community-board`
**Created**: 2026-01-25
**Status**: Draft
**Input**: PRD V2 기반 댓글 및 대댓글 기능 명세

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 댓글 작성 (Priority: P1)

정회원이 게시글에 의견이나 정보를 담은 댓글을 작성한다.

**Why this priority**: 댓글은 커뮤니티 상호작용의 핵심 기능으로, 회원 간 소통을 위해 필수적이다.

**Independent Test**: 정회원이 게시글에 댓글을 작성하고 댓글 목록에서 확인할 수 있으면 테스트 통과

**Acceptance Scenarios**:

1. **Given** 정회원이 게시글 상세 페이지에서, **When** 댓글 내용을 입력하고 등록 버튼을 클릭하면, **Then** 댓글이 추가되고 댓글 목록에 표시된다
2. **Given** 정회원이 자유게시판 댓글 작성 시, **When** 익명 옵션을 선택하고 작성하면, **Then** 댓글 작성자가 "익명"으로 표시된다
3. **Given** 정회원이 댓글 작성 시, **When** 500자를 초과하는 내용을 입력하면, **Then** 작성이 거부되고 "댓글은 500자 이내여야 합니다" 메시지가 표시된다
4. **Given** 정보공유 게시판에서 댓글 작성 시, **When** 익명 옵션을 찾으면, **Then** 익명 옵션이 존재하지 않는다

---

### User Story 2 - 대댓글 작성 (Priority: P1)

사용자가 특정 댓글에 답글(대댓글)을 작성하여 대화를 이어간다.

**Why this priority**: 대댓글은 특정 의견에 대한 토론을 가능하게 하는 필수 기능이다.

**Independent Test**: 댓글에 대댓글을 작성하고 해당 댓글 하위에 표시되는지 확인

**Acceptance Scenarios**:

1. **Given** 게시글의 댓글에서, **When** 답글 버튼을 클릭하고 내용을 입력하여 등록하면, **Then** 해당 댓글의 하위에 대댓글이 표시된다
2. **Given** 대댓글에서, **When** 답글 버튼을 클릭하면, **Then** "대댓글에는 답글을 달 수 없습니다" 메시지가 표시되거나 답글 버튼이 없다
3. **Given** 익명으로 대댓글을 작성할 때, **When** 해당 게시판이 익명 허용인 경우, **Then** 대댓글도 익명으로 작성 가능하다

---

### User Story 3 - 댓글 조회 (Priority: P1)

사용자가 게시글의 모든 댓글과 대댓글을 확인한다.

**Why this priority**: 댓글 조회는 커뮤니티 콘텐츠 소비의 핵심 부분이다.

**Independent Test**: 게시글 상세 페이지에서 댓글과 대댓글이 계층 구조로 표시되는지 확인

**Acceptance Scenarios**:

1. **Given** 게시글 상세 페이지 접근 시, **When** 페이지가 로드되면, **Then** 모든 댓글과 대댓글이 계층 구조로 표시된다
2. **Given** 삭제된 댓글이 있을 때, **When** 댓글 목록을 조회하면, **Then** "삭제된 댓글입니다"로 표시된다
3. **Given** 삭제된 댓글에 대댓글이 있을 때, **When** 댓글 목록을 조회하면, **Then** 대댓글은 정상 표시되고 부모 댓글만 "삭제된 댓글입니다"로 표시된다

---

### User Story 4 - 댓글 삭제 (Priority: P2)

댓글 작성자가 본인이 작성한 댓글을 삭제한다.

**Why this priority**: 부적절하거나 실수로 작성한 댓글을 제거하기 위해 필요하지만, 작성/조회보다 빈도가 낮다.

**Independent Test**: 작성자가 댓글을 삭제하고 "삭제된 댓글입니다"로 표시되는지 확인

**Acceptance Scenarios**:

1. **Given** 본인이 작성한 댓글에서, **When** 삭제 버튼을 클릭하고 확인하면, **Then** 댓글이 "삭제된 댓글입니다"로 변경된다
2. **Given** 대댓글이 있는 댓글을 삭제할 때, **When** 삭제를 실행하면, **Then** 부모 댓글은 "삭제된 댓글입니다"로 표시되고 대댓글은 유지된다
3. **Given** 타인이 작성한 댓글에서, **When** 삭제를 시도하면, **Then** 삭제 버튼이 표시되지 않거나 접근이 거부된다
4. **Given** 관리자가 타인의 댓글에 접근할 때, **When** 삭제를 시도하면, **Then** 관리자 권한으로 삭제가 가능하다

---

### Edge Cases

- 게시글이 삭제된 상태에서 댓글을 작성하면 어떻게 되는가? → 댓글 작성 불가, "삭제된 게시글입니다" 메시지 표시
- 댓글 작성 중 게시글이 삭제되면 어떻게 되는가? → 저장 시점에 게시글 상태 확인 후 실패 처리
- 대댓글의 부모 댓글이 삭제되면 어떻게 되는가? → 부모는 "삭제된 댓글입니다"로 표시, 대댓글은 유지
- 빈 내용으로 댓글 작성 시도 시 어떻게 되는가? → 작성 거부 및 "내용을 입력해 주세요" 메시지 표시

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 시스템은 댓글 내용을 최대 500자까지 허용해야 한다
- **FR-002**: 시스템은 대댓글을 1단계까지만 허용해야 한다 (댓글의 댓글까지, 대댓글의 대댓글 불가)
- **FR-003**: 익명 허용 게시판에서만 익명 댓글/대댓글 작성이 가능해야 한다
- **FR-004**: 본인이 작성한 댓글만 삭제 가능해야 한다 (관리자 예외)
- **FR-005**: 댓글 삭제 시 Soft Delete를 적용하여 데이터를 보존해야 한다
- **FR-006**: 삭제된 댓글은 UI에 "삭제된 댓글입니다"로 표시해야 한다
- **FR-007**: 대댓글이 있는 댓글이 삭제되어도 대댓글은 유지되어야 한다
- **FR-008**: 댓글 수정 기능은 제공하지 않는다 (삭제 후 재작성)
- **FR-009**: 게시글 상세 조회 시 댓글 목록이 계층 구조로 함께 반환되어야 한다
- **FR-010**: 삭제된 게시글에는 새 댓글을 작성할 수 없어야 한다
- **FR-011**: ~~시스템은 사용자별 댓글 작성 Rate Limit을 적용하여 스팸을 방지해야 한다~~ (추후 구현으로 연기)
- **FR-012**: 댓글 목록은 등록순(오래된 댓글 먼저)으로 정렬되어야 한다
- **FR-013**: 익명 댓글도 DB에 작성자 정보를 저장하되, API 응답에서는 작성자 정보를 제외해야 한다 (관리자 추적 가능)
- **FR-014**: 댓글 목록은 페이지네이션 없이 전체를 한 번에 로드해야 한다
- **FR-015**: 댓글 좋아요 기능 - 좋아요 수는 모든 사용자에게 공개되며, 좋아요 취소가 가능하고, 본인 댓글에는 좋아요할 수 없다
- **FR-016**: 댓글 신고 기능 - 신고 접수 시 관리자 검토 대기열에 추가되며, 관리자가 수동으로 처리해야 한다
- **FR-017**: 댓글 멘션(@) 기능 - @사용자명으로 정회원 이상의 사용자를 멘션할 수 있으며, 멘션된 사용자에게 인앱 알림과 이메일 알림이 발송된다

### Key Entities

- **Comment**: 댓글 정보 - 게시글 참조, 부모 댓글 참조(대댓글인 경우), 작성자, 내용, 익명 여부, 삭제 여부, 작성일
- **CommentLike**: 댓글 좋아요 정보 - 댓글 참조, 사용자 참조, 생성일
- **CommentReport**: 댓글 신고 정보 - 댓글 참조, 신고자 참조, 신고 사유, 처리 상태, 생성일

## Clarifications

### Session 2026-01-26

- Q: Rate Limit의 구체적인 값은? → A: 추후 구현으로 연기 (Rate Limit 미적용)

### Session 2026-01-25

- Q: 댓글 스팸 또는 어뷰징 방지를 어떻게 처리해야 하는가? → A: 사용자별 Rate Limit 적용 (예: 분당 최대 N개 댓글)
- Q: 댓글 목록의 기본 정렬 순서는 무엇이어야 하는가? → A: 등록순 (오래된 댓글 먼저, 시간순 대화 흐름)
- Q: 익명 댓글 작성 시 백엔드에서 실제 작성자 정보를 어떻게 관리해야 하는가? → A: DB에 작성자 저장, API 응답에서만 숨김 (관리자 추적 가능)
- Q: 댓글이 많은 게시글에서 댓글 목록을 어떻게 로드해야 하는가? → A: 전체 로드 (페이지네이션 없음, 단순 구현)
- Q: 댓글 기능의 범위 외(Out of Scope)로 명시적으로 제외할 항목은 무엇인가? → A: 제외 항목 없음 (댓글 좋아요, 신고, 멘션 기능 모두 범위에 포함)
- Q: 댓글 좋아요 기능의 공개 범위와 취소 가능 여부는? → A: 좋아요 수 공개, 좋아요 취소 가능
- Q: 댓글 신고 처리 방식은? → A: 관리자 검토 대기열에 추가, 수동 처리
- Q: 댓글 멘션(@) 알림 방식은? → A: 인앱 알림 + 이메일 알림
- Q: 멘션 대상 범위는? → A: 정회원 이상의 사용자 멘션 가능
- Q: 본인 댓글에 좋아요 가능 여부는? → A: 본인 댓글에 좋아요 불가

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 댓글 작성이 10초 이내에 완료된다
- **SC-002**: 대댓글 depth 제한이 100% 적용되어 2단계 이상의 대댓글이 생성되지 않는다
- **SC-003**: 삭제된 댓글의 대댓글이 100% 보존된다
- **SC-004**: 익명 댓글의 작성자 정보가 외부에 노출되지 않는다
- **SC-005**: 사용자가 댓글 작성 시 혼란 없이 익명 여부를 선택할 수 있다
